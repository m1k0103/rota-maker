<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename= 'style.css') }}">
</head>
<body>
    
    <h1><u>Employee Management</u></h1>

     {% for name,surname in employee_list %}
    <div class="employee-box">
        <div class="employee-info">
            <div class="name">{{ name }}</div>
            <div class="surname">{{ surname }}</div>
        </div>
        <div class="action-buttons">
            <button class="edit-days" name="{{ name }}" onclick="openPopup(this,'shifts')">Edit shifts</button>
            <button class="edit-days" name="{{ name }}" onclick="openPopup(this,'availability')">Edit availability</button>
        </div>
    </div>
    {% endfor %}

    <!-- Shifts Popup -->
    <div id="popup-shifts" class="popup-shifts">
        <div class="popup-content-shifts">
            <span class="close" onclick="closePopup()">&times;</span>
            <p id="popup-text-shifts"></p>
        </div>

    </div>
    <!-- Availibility popup -->
    <div id="popup-availability" class="popup-availability">
        <div class="popup-content-availability">
            <span class="close" onclick="closePopup()">&times;</span>
            <p id="popup-text-availability"></p>
        </div>
    </div>
    
    
    
<script>
    // Function to get employee details from name and return them
async function get_details(employee_name){
    console.log(employee_name)
    const xhttp = new XMLHttpRequest()
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200){
            document.getElementById("popup-text-shifts").innerHTML = this.responseText
            console.log(this.responseText)
        }
    }
    const json = {
        "employee_name":employee_name
    }
    xhttp.open("POST", "/get_employee_shifts", true)
    xhttp.setRequestHeader("Content-Type", "application/json; charset=UTF-8")
    xhttp.send(JSON.stringify(json))
}

async function availability(employee_name){
    console.log(employee_name)
    const xhttp = new XMLHttpRequest()
    xhttp.onreadystatechange = function(){
        if (this.readyState == 4 && this.status == 200){ // if successful
            document.getElementById("popup-text-availability").innerHTML = this.responseText
        }
    }
    const json = {"employee_name":employee_name}
    xhttp.open("POST", "/add_availability", true)
    xhttp.setRequestHeader("Content-Type", "application/json; charset=UTF-8")
    xhttp.send(JSON.stringify(json))
}


        // Function to open the popup
function openPopup(el, type) {
    console.log(type)
    if (type == 'shifts'){
        const employee_name = el.name
        const popup = document.getElementById("popup-shifts");
        const popupText = document.getElementById("popup-text-shifts");
        get_details(employee_name)
        // Show the popup
        popup.style.display = "flex";
    }
    else if (type == 'availability'){
        const employee_name = el.name
        const popup = document.getElementById("popup-availability");
        const popupText = document.getElementById("popup-text-availability");
        availability(employee_name)
        // Show the popup
        popup.style.display = "flex";
    }
}

// Function to close the popup
function closePopup() {
    const popup = document.getElementById("popup-shifts")
    popup.style.display = "none"
    const popup2 = document.getElementById("popup-availability")
    popup2.style.display = "none"
}

function show_edit_menu(id){
    document.getElementById("update_shifts_menu").style.display = "flex"
    document.getElementById("form_shift_id").value = id
}


    </script>
</body>
</html>
